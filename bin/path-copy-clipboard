#!/usr/bin/env bash
#/ Copy the current directory (or child entry) to the clipboard.
#/
#/ Usage: $(basename "$0") [-h] [-v] [entry]
#/
#/ Available options:
#/    -h, --help      Print this help and exit
#/    -v, --verbose   Enable verbose output
#/
#/ Details:
#/    When no entry is provided, copies the working directory path.

set -Eeuo pipefail
trap script.cleanup SIGINT SIGTERM ERR EXIT

source "$(dirname "$0")/../lib/bash/utils"

script_dir=$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd -P)

verbose=0
declare -a args=()

parse_args() {
  args=()

  while [[ $# -gt 0 ]]; do
    case "$1" in
      -h|--help)
        script.usage
        ;;
      -v|--verbose)
        verbose=1
        ;;
      --)
        shift
        break
        ;;
      --*)
        log.error "Unknown option: $1"
        script.usage 1
        ;;
      *)
        break
        ;;
    esac
    shift
  done

  while [[ $# -gt 0 ]]; do
    args+=("$1")
    shift
  done

  if (( ${#args[@]} > 1 )); then
    log.error "At most one entry may be provided"
    script.usage 1
  fi
}

main() {
  local base_path entry target
  base_path=$(pwd)
  entry="${args[0]:-}"

  if [[ -n "$entry" ]]; then
    target="${base_path%/}/$entry"
  else
    target="$base_path"
  fi

  printf '%s' "$target" | clip.copy

  (( verbose )) && log.info "Copied path to clipboard: $target"
}

parse_args "$@"
main
